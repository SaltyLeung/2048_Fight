{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Game.js"],"names":["Game","cc","Class","extends","Component","properties","isP2","destroySpeed","timeOut","vsController","default","type","require","squarePrefab","Prefab","positionList","Node","eatableList","Boolean","moveableList","onLoad","i","number","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","start","randomCreate","update","dt","emptyPos","Array","push","length","gameOver","index","Math","floor","random","newValue","newSquare","instantiate","setPosition","getPosition","getComponent","gameScript","node","addChild","Animation","play","console","log","moveDown","hasBeenMove","j","hasMerge","targetIndex","isMerge","k","toDestroyed","tempTarget","temp","move","tempList","moveUp","moveLeft","moveRight","event","keyCode","KEY","s","scheduleOnce","w","d","a","onSlide","direction","module","exports"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\nvar Game = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        isP2: false,\r\n        destroySpeed: 2,\r\n        //fadeSpeed: 0.4,\r\n        timeOut : true,\r\n        vsController: {\r\n            default: null,\r\n            type: require(\"VSController\")\r\n        },\r\n        squarePrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        positionList: {   //不动，最下面一行为0 1 2 3 倒数第二行为 4 5 6 7 以此类推  具有子属性number\r\n            default: [],\r\n            type:[cc.Node]\r\n        },\r\n        eatableList: {  //该节点位置是否可吞\r\n            default: [],\r\n            type:[cc.Boolean]\r\n        },\r\n        moveableList: {   //管理可移动方框\r\n            default: [],\r\n            type:[cc.Node]\r\n        }\r\n\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        for(var i = 0; i < 16; ++i) {\r\n            this.positionList[i].number = 0;\r\n            this.moveableList[i] = null;\r\n            this.eatableList[i] = false;\r\n        }\r\n        \r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        \r\n    },\r\n\r\n    start () {\r\n        this.randomCreate();\r\n        //console.log(\"aaaaa\");\r\n    },\r\n    update(dt) {\r\n     \r\n    },\r\n\r\n    randomCreate() {\r\n        //找随机空位\r\n        var emptyPos = new Array();\r\n        for(var i = 0; i < 16; ++i) if(this.positionList[i].number == 0) emptyPos.push(i);\r\n        if(emptyPos.length == 0) this.gameOver();\r\n        var index = Math.floor(Math.random() * emptyPos.length);\r\n        \r\n        //随机生成2或4\r\n        var newValue = (1 + Math.floor(Math.random() * 2)) * 2;\r\n\r\n        var newSquare = cc.instantiate(this.squarePrefab);\r\n        //console.log(newSquare);\r\n        newSquare.setPosition(this.positionList[emptyPos[index]].getPosition());\r\n\r\n        newSquare.getComponent(require(\"Square\")).number = newValue;\r\n        newSquare.getComponent(require(\"Square\")).gameScript = this;\r\n        //newSquare.setGlobalZOrder(1000);\r\n        this.node.addChild(newSquare);\r\n        newSquare.getComponent(cc.Animation).play(\"2048Show\");\r\n\r\n        this.positionList[emptyPos[index]].number = newValue;\r\n        this.moveableList[emptyPos[index]] = newSquare;\r\n        console.log(\"----------\");\r\n        //console.log(emptyPos[index]);\r\n        for(var i = 0; i < 16; ++i) { if(this.moveableList[i]!=null) console.log(\"moveableNum\"+i+\": \"+this.moveableList[i].getPosition());}\r\n        for(var i = 0; i < 16; ++i) {console.log(\"position\"+i+\": \"+this.positionList[i].number);}\r\n        \r\n    },\r\n    moveDown() {\r\n        var hasBeenMove = false;\r\n        /*for(var i = 0; i < 16; ++i) {\r\n            this.eatableList[i] = true;\r\n        }\r\n        for(var i = 4; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].down(i);\r\n        }*///标记已经合并的并且挪出空位\r\n        for(var i = 0; i < 4; ++i) {  //列\r\n            for(var j = i; j < 16; j += 4) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n               // var hasHole = [false, false, false, false];\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j - 4; k >= 0; k -= 4) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        //hasHole[Math.floor(j/4)] = true; \r\n                        //this.positionList[k].number = this.positionList[j].number; \r\n                        //this.positionList[j].number = 0;  \r\n                        continue; \r\n                    }\r\n                   // else if(hasHole[Math.floor(k/4)] == true) { targetIndex = k; hasHole[Math.floor(j/4)] = true; continue; }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                       // hasHole[Math.floor(j/4)] = true; \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        //this.moveableList[k].getComponent(require(\"Square\")).toDouble = true;\r\n                        isMerge = true;\r\n                        //this.positionList[j].number = 0;\r\n                        //this.positionList[k].number *= 2;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                //console.log(i+ \" \" +j +\"targetIndex \"+targetIndex);\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 4; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move(this);   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true)) {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); this.moveableList[i] = null; \r\n            }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        //for(var j = 0; j < 16; ++j)console.log(\"TempList\"+j+\" : \"+tempList[j]);\r\n        //for(var j = 0; j < 16; ++j)console.Log\r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i] != null) {\r\n                //console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i];\r\n             }\r\n        }   //moveableList复位\r\n        //for(var j = 0; j < 16; ++j)console.log(\"mList(aftertemp)\"+j+\" : \"+this.moveableList[j]);\r\n        for(var i = 0; i < 16; ++i) {\r\n            /*if(this.moveableList[i] == null) this.positionList[i].number = 0;\r\n            else if(this.moveableList[i].getComponent(require(\"Square\")).toDouble == true) {\r\n                this.moveableList[i].getComponent(require(\"Square\")).number *= 2; \r\n                this.positionList[i].number = this.moveableList[i].getComponent(require(\"Square\")).number;\r\n                this.moveableList[i].getComponent(require(\"Square\")).toDouble = false;\r\n            }else  this.positionList[i].number = this.moveableList[i].getComponent(require(\"Square\")).number;*/\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    /*onKeyDown (event) {\r\n        // set a flag when key pressed\r\n        if(this.timeOut == false) return;  //屏蔽输入\r\n        switch(event.keyCode) {\r\n            case cc.KEY.s:\r\n                if(this.moveDown() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                //for(var i = 0; i < 16; ++i) console.log(this.moveableList[i]);\r\n                break;\r\n        }\r\n    },*/\r\n    moveUp() {\r\n        var hasBeenMove = false;\r\n        for(var i = 12; i < 16; ++i) {  //列\r\n            for(var j = i; j >= 0; j -= 4) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j + 4; k < 16; k += 4) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        continue; \r\n                    }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        isMerge = true;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move(this);   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true))   {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); \r\n                this.moveableList[i] = null;  \r\n            }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i]!=null) {\r\n                //console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i];\r\n           }\r\n        }   //moveableList复位\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    moveLeft() {\r\n        var hasBeenMove = false;\r\n        for(var i = 0; i <= 12 ; i += 4) {  //列\r\n            for(var j = i; j < i + 4; ++j) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j - 1; k >= i; --k) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        continue; \r\n                    }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        isMerge = true;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move(this);   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true)) {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); \r\n                this.moveableList[i] = null; \r\n            }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i]!=null) {\r\n                console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i]; \r\n        }\r\n        }   //moveableList复位\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    moveRight() {\r\n        var hasBeenMove = false;\r\n        for(var i = 3; i <= 15; i += 4) {  //列\r\n            for(var j = i; j > i - 4; --j) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j + 1; k <= i; ++k) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        continue; \r\n                    }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        isMerge = true;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move(this);   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true)) {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); \r\n                this.moveableList[i] = null;\r\n             }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i]!=null) {\r\n                console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i]; \r\n            }\r\n        }   //moveableList复位\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    onKeyDown (event) {\r\n        // set a flag when key pressed\r\n        if(this.timeOut == false) return;  //屏蔽输入\r\n        switch(event.keyCode) {\r\n            case cc.KEY.s:\r\n                if(this.moveDown() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                //for(var i = 0; i < 16; ++i) console.log(this.moveableList[i]);\r\n                break;\r\n            case cc.KEY.w:\r\n                if(this.moveUp() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                break;  \r\n            case cc.KEY.d:\r\n                if(this.moveRight() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                break;\r\n            case cc.KEY.a:\r\n                if(this.moveLeft() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                break;  \r\n            default:\r\n                break;  \r\n        }\r\n    },\r\n    onSlide (direction) {    //1下 2上 3右 4左\r\n        // set a flag when key pressed\r\n        if(this.timeOut == false) return false;  //屏蔽输入\r\n        switch(direction) {\r\n            case \"down\":\r\n                if(this.moveDown() == false) return false;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();},0.8);\r\n                //for(var i = 0; i < 16; ++i) console.log(this.moveableList[i]);\r\n                break;\r\n            case \"up\":\r\n                if(this.moveUp() == false) return false;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();},0.8);\r\n                break;  \r\n            case \"right\":\r\n                if(this.moveRight() == false) return false;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true; this.randomCreate();},0.8);\r\n                break;\r\n            case \"left\":\r\n                if(this.moveLeft() == false) return false;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();},0.8);\r\n                break;  \r\n            default:\r\n                break;  \r\n        } return true;\r\n    },\r\n    /*eat(source, target, newNode) {\r\n        this.moveableList[target].destroy();\r\n        this.moveableList[target] = this.moveableList[source];\r\n        this.moveableList[source] = null;\r\n\r\n        this.eatableList[target] = false;\r\n\r\n        this.positionList[source].number = 0;\r\n        this.positionList[target].number *= 2;\r\n        \r\n    },*/\r\n\r\n    gameOver() {\r\n      \r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n\r\nmodule.exports = Game;\r\n"]}