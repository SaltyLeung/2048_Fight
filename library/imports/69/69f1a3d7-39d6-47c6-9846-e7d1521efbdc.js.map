{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Game.js"],"names":["Game","cc","Class","extends","Component","properties","destroySpeed","timeOut","squarePrefab","default","type","Prefab","positionList","Node","eatableList","Boolean","moveableList","onLoad","i","number","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","start","randomCreate","update","dt","emptyPos","Array","push","length","gameOver","index","Math","floor","random","newValue","newSquare","instantiate","setPosition","getPosition","getComponent","require","gameScript","node","addChild","Animation","play","console","log","moveDown","hasBeenMove","j","hasMerge","targetIndex","isMerge","k","toDestroyed","tempTarget","temp","move","tempList","moveUp","moveLeft","moveRight","event","keyCode","KEY","s","scheduleOnce","w","d","a","module","exports"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\nvar Game = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        destroySpeed: 2,\r\n        //fadeSpeed: 0.4,\r\n        timeOut : true,\r\n        squarePrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        positionList: {   //不动，最下面一行为0 1 2 3 倒数第二行为 4 5 6 7 以此类推  具有子属性number\r\n            default: [],\r\n            type:[cc.Node]\r\n        },\r\n        eatableList: {  //该节点位置是否可吞\r\n            default: [],\r\n            type:[cc.Boolean]\r\n        },\r\n        moveableList: {   //管理可移动方框\r\n            default: [],\r\n            type:[cc.Node]\r\n        }\r\n\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        for(var i = 0; i < 16; ++i) {\r\n            this.positionList[i].number = 0;\r\n            this.moveableList[i] = null;\r\n            this.eatableList[i] = false;\r\n        }\r\n        \r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    },\r\n\r\n    start () {\r\n        this.randomCreate();\r\n        //console.log(\"aaaaa\");\r\n    },\r\n    update(dt) {\r\n     \r\n    },\r\n\r\n    randomCreate() {\r\n        //找随机空位\r\n        var emptyPos = new Array();\r\n        for(var i = 0; i < 16; ++i) if(this.positionList[i].number == 0) emptyPos.push(i);\r\n        if(emptyPos.length == 0) this.gameOver();\r\n        var index = Math.floor(Math.random() * emptyPos.length);\r\n        \r\n        //随机生成2或4\r\n        var newValue = (1 + Math.floor(Math.random() * 2)) * 2;\r\n\r\n        var newSquare = cc.instantiate(this.squarePrefab);\r\n        //console.log(newSquare);\r\n        newSquare.setPosition(this.positionList[emptyPos[index]].getPosition());\r\n\r\n        newSquare.getComponent(require(\"Square\")).number = newValue;\r\n        newSquare.getComponent(require(\"Square\")).gameScript = this;\r\n        //newSquare.setGlobalZOrder(1000);\r\n        this.node.addChild(newSquare);\r\n        newSquare.getComponent(cc.Animation).play(\"2048Show\");\r\n\r\n        this.positionList[emptyPos[index]].number = newValue;\r\n        this.moveableList[emptyPos[index]] = newSquare;\r\n        console.log(\"----------\");\r\n        //console.log(emptyPos[index]);\r\n        for(var i = 0; i < 16; ++i) { if(this.moveableList[i]!=null) console.log(\"moveableNum\"+i+\": \"+this.moveableList[i].getPosition());}\r\n        for(var i = 0; i < 16; ++i) {console.log(\"position\"+i+\": \"+this.positionList[i].number);}\r\n        \r\n    },\r\n    moveDown() {\r\n        var hasBeenMove = false;\r\n        /*for(var i = 0; i < 16; ++i) {\r\n            this.eatableList[i] = true;\r\n        }\r\n        for(var i = 4; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].down(i);\r\n        }*///标记已经合并的并且挪出空位\r\n        for(var i = 0; i < 4; ++i) {  //列\r\n            for(var j = i; j < 16; j += 4) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n               // var hasHole = [false, false, false, false];\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j - 4; k >= 0; k -= 4) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        //hasHole[Math.floor(j/4)] = true; \r\n                        //this.positionList[k].number = this.positionList[j].number; \r\n                        //this.positionList[j].number = 0;  \r\n                        continue; \r\n                    }\r\n                   // else if(hasHole[Math.floor(k/4)] == true) { targetIndex = k; hasHole[Math.floor(j/4)] = true; continue; }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                       // hasHole[Math.floor(j/4)] = true; \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        //this.moveableList[k].getComponent(require(\"Square\")).toDouble = true;\r\n                        isMerge = true;\r\n                        //this.positionList[j].number = 0;\r\n                        //this.positionList[k].number *= 2;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                //console.log(i+ \" \" +j +\"targetIndex \"+targetIndex);\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 4; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move();   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true)) {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); this.moveableList[i] = null; \r\n            }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        //for(var j = 0; j < 16; ++j)console.log(\"TempList\"+j+\" : \"+tempList[j]);\r\n        //for(var j = 0; j < 16; ++j)console.Log\r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i] != null) {\r\n                //console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i];\r\n             }\r\n        }   //moveableList复位\r\n        //for(var j = 0; j < 16; ++j)console.log(\"mList(aftertemp)\"+j+\" : \"+this.moveableList[j]);\r\n        for(var i = 0; i < 16; ++i) {\r\n            /*if(this.moveableList[i] == null) this.positionList[i].number = 0;\r\n            else if(this.moveableList[i].getComponent(require(\"Square\")).toDouble == true) {\r\n                this.moveableList[i].getComponent(require(\"Square\")).number *= 2; \r\n                this.positionList[i].number = this.moveableList[i].getComponent(require(\"Square\")).number;\r\n                this.moveableList[i].getComponent(require(\"Square\")).toDouble = false;\r\n            }else  this.positionList[i].number = this.moveableList[i].getComponent(require(\"Square\")).number;*/\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    /*onKeyDown (event) {\r\n        // set a flag when key pressed\r\n        if(this.timeOut == false) return;  //屏蔽输入\r\n        switch(event.keyCode) {\r\n            case cc.KEY.s:\r\n                if(this.moveDown() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                //for(var i = 0; i < 16; ++i) console.log(this.moveableList[i]);\r\n                break;\r\n        }\r\n    },*/\r\n    moveUp() {\r\n        var hasBeenMove = false;\r\n        for(var i = 12; i < 16; ++i) {  //列\r\n            for(var j = i; j >= 0; j -= 4) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j + 4; k < 16; k += 4) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        continue; \r\n                    }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        isMerge = true;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move();   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true))   {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); \r\n                this.moveableList[i] = null;  \r\n            }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i]!=null) {\r\n                //console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i];\r\n           }\r\n        }   //moveableList复位\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    moveLeft() {\r\n        var hasBeenMove = false;\r\n        for(var i = 0; i <= 12 ; i += 4) {  //列\r\n            for(var j = i; j < i + 4; ++j) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j - 1; k >= i; --k) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        continue; \r\n                    }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        isMerge = true;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move();   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true)) {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); \r\n                this.moveableList[i] = null; \r\n            }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i]!=null) {\r\n                console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i]; \r\n        }\r\n        }   //moveableList复位\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    moveRight() {\r\n        var hasBeenMove = false;\r\n        for(var i = 3; i <= 15; i += 4) {  //列\r\n            for(var j = i; j > i - 4; --j) {   //每列中每个\r\n                if(this.moveableList[j] == null)  continue;\r\n                var hasMerge = [false, false, false, false];\r\n                var targetIndex = j;\r\n                var isMerge = false;\r\n                for(var k = j + 1; k <= i; ++k) {    //计算目标\r\n                    if(this.positionList[k].number == 0) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k; \r\n                        continue; \r\n                    }\r\n                    else if((this.positionList[k].number == this.positionList[j].number) && (hasMerge[Math.floor(k/4)] == false)) { \r\n                        hasBeenMove = true;\r\n                        targetIndex = k;  \r\n                        hasMerge[Math.floor(k/4)] = true; \r\n                        this.moveableList[j].getComponent(require(\"Square\")).toDestroyed = true;\r\n                        isMerge = true;\r\n                        break; \r\n                    }\r\n                    else break;   \r\n                }\r\n                this.moveableList[j].getComponent(require(\"Square\")).tempTarget = targetIndex;\r\n                var temp = this.positionList[j].number;\r\n                this.positionList[j].number = 0;\r\n                this.positionList[targetIndex].number = temp;\r\n                if(isMerge == true) this.positionList[targetIndex].number *= 2;\r\n            }\r\n        }\r\n\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null)  this.moveableList[i].getComponent(require(\"Square\")).move();   \r\n        }  //物理移动（逻辑上还没移动），移动后下标为source，target为目标\r\n        for(var i = 0; i < 16; ++i) {\r\n            if((this.moveableList[i] != null) && (this.moveableList[i].getComponent(require(\"Square\")).toDestroyed == true)) {  \r\n                this.moveableList[i].getComponent(cc.Animation).play(\"2048Fade\"); \r\n                this.moveableList[i] = null;\r\n             }\r\n        }    //删除多余卡片 \r\n        \r\n        var tempList = new Array(); \r\n        for(var j = 0; j < 16; ++j) tempList[j] = this.moveableList[j]; \r\n        for(var j = 0; j < 16; ++j) this.moveableList[j] = null; \r\n        for(var i = 0; i < 16; ++i) {\r\n            if(tempList[i]!=null) {\r\n                console.log(\"TYpe\"+typeof(tempList[i].getComponent(require(\"Square\")).tempTarget));\r\n                this.moveableList[tempList[i].getComponent(require(\"Square\")).tempTarget] = tempList[i]; \r\n            }\r\n        }   //moveableList复位\r\n        for(var i = 0; i < 16; ++i) {\r\n            if(this.moveableList[i] != null) this.moveableList[i].getComponent(require(\"Square\")).number = this.positionList[i].number; \r\n        }   //维护positionList\r\n        return hasBeenMove;\r\n    },\r\n    onKeyDown (event) {\r\n        // set a flag when key pressed\r\n        if(this.timeOut == false) return;  //屏蔽输入\r\n        switch(event.keyCode) {\r\n            case cc.KEY.s:\r\n                if(this.moveDown() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                //for(var i = 0; i < 16; ++i) console.log(this.moveableList[i]);\r\n                break;\r\n            case cc.KEY.w:\r\n                if(this.moveUp() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                break;  \r\n            case cc.KEY.d:\r\n                if(this.moveRight() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                break;\r\n            case cc.KEY.a:\r\n                if(this.moveLeft() == false) return;\r\n                this.timeOut = false;\r\n                this.scheduleOnce(function() {this.timeOut = true;this.randomCreate();console.log(\"sca\");},0.5);\r\n                break;  \r\n            default:\r\n                break;  \r\n        }\r\n    },\r\n    /*eat(source, target, newNode) {\r\n        this.moveableList[target].destroy();\r\n        this.moveableList[target] = this.moveableList[source];\r\n        this.moveableList[source] = null;\r\n\r\n        this.eatableList[target] = false;\r\n\r\n        this.positionList[source].number = 0;\r\n        this.positionList[target].number *= 2;\r\n        \r\n    },*/\r\n\r\n    gameOver() {\r\n      \r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n\r\nmodule.exports = Game;\r\n"]}