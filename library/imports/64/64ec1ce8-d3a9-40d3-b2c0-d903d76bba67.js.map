{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\BombButton.js"],"names":["BombButton","cc","Class","extends","Component","properties","VSController","default","type","require","bombPrefab","Prefab","bombIns","Node","press","label","Label","bombIsOK","game","start","node","on","EventType","TOUCH_START","onTouchStart","event","console","log","instantiate","parent","director","getScene","setPosition","touch","getLocation","TOUCH_CANCEL","release","TOUCH_END","cancel","TOUCH_MOVE","onTouchMove","getComponent","selectedIndex","unschedule","timeInterval","destroyIndex","Animation","play","temp","setTimeout","destroy","switchSide","gameOver","clearStepCount","off","update","dt","stepCount","string","module","exports"],"mappings":"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","file":"BombButton.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\nvar BombButton = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        VSController:{\r\n            default:null,\r\n            type:require(\"VSController\")\r\n        },\r\n        bombPrefab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        bombIns:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        press:false,\r\n        label:{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n        bombIsOK:false,\r\n        game:{\r\n            default:null,\r\n            type:require(\"Game\")\r\n        }\r\n    },\r\n    \r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start () {\r\n        this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this);\r\n        \r\n\r\n    },\r\n    onTouchStart(event) {\r\n        if(this.bombIsOK == false) return;\r\n        //cc.instantiate(this.bombPrefab);\r\n        //console.log(\"touchbutton\");\r\n        if(this.press == false) {\r\n            console.log(\"instantiate\"); \r\n            this.bombIns = cc.instantiate(this.bombPrefab); \r\n            this.bombIns.parent = cc.director.getScene();\r\n            this.bombIns.setPosition(event.touch.getLocation());\r\n           /* this.bombIns.getComponent(require(\"Bomb\")).start();*/\r\n            this.press = true;\r\n            this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.release,this);\r\n            this.node.on(cc.Node.EventType.TOUCH_END,this.cancel,this);\r\n            this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this);\r\n        }\r\n    },\r\n    onTouchMove(event) {\r\n        //console.log(\"movebomb\");\r\n        this.bombIns.setPosition(event.touch.getLocation());\r\n    },\r\n    release(event) {\r\n        //console.log(\"releasebutton\");\r\n        if(this.bombIns.getComponent(require(\"Bomb\")).selectedIndex == -1) this.cancel(event);\r\n        this.VSController.unschedule(this.VSController.timeInterval);\r\n        console.log(event.touch.getLocation());\r\n        this.VSController.destroyIndex(this.bombIns.getComponent(require(\"Bomb\")).selectedIndex);\r\n        this.bombIns.getComponent(cc.Animation).play(\"bomb_explosion\");\r\n        var temp = this.bombIns;\r\n        this.bombIns = null;\r\n        setTimeout(()=>{\r\n            temp.destroy();\r\n            this.VSController.switchSide();\r\n            if(this.game.gameOver == true) this.game.gameOver = false;\r\n        },800);\r\n        this.press = false;\r\n        //this.bombIsOK = false;\r\n        this.VSController.clearStepCount();\r\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.release,this);\r\n        this.node.off(cc.Node.EventType.TOUCH_END,this.cancel,this);\r\n        this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this);\r\n    },\r\n    cancel(event) {\r\n        console.log(\"cancle\");\r\n        var temp = this.bombIns;\r\n        this.bombIns = null;\r\n        if(temp!=null)temp.destroy();\r\n        this.press = false;\r\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.release,this);\r\n        this.node.off(cc.Node.EventType.TOUCH_END,this.cancel,this);\r\n        this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this);\r\n    },\r\n    \r\n    update (dt) {\r\n        if(this.VSController.stepCount  >= 5) { this.label.string = \"OK\";this.bombIsOK = true; }\r\n        else this.label.string = this.VSController.stepCount;\r\n    },\r\n});\r\nmodule.exports = BombButton;"]}